import{r as o,j as e,m as k,t as b}from"./index-DfHiWpns.js";function C({userId:a="default",topicId:l,topicTitle:s,totalSteps:r,currentStep:i,onProgressUpdate:x}){const[t,d]=o.useState({topicId:l,topicTitle:s,currentStep:i,totalSteps:r,lastUpdated:new Date().toISOString(),timeSpent:0}),[h]=o.useState(Date.now());o.useEffect(()=>{const n=localStorage.getItem(`progress_${a}_${l}`);if(n)try{const p=JSON.parse(n);d(p)}catch(p){console.warn("Failed to parse saved progress:",p)}},[a,l]);const u=n=>{localStorage.setItem(`progress_${a}_${l}`,JSON.stringify(n)),d(n),x==null||x(n.currentStep/n.totalSteps)},m=n=>{const p=Math.floor((Date.now()-h)/6e4),N={...t,currentStep:Math.max(n,t.currentStep),lastUpdated:new Date().toISOString(),timeSpent:t.timeSpent+p,completedAt:n>=r?new Date().toISOString():void 0};u(N),n>=r?b.success(`ğŸ‰ æ­å–œå®Œæˆã€Š${s}ã€‹çš„å­¦ä¹ ï¼`):b.success(`âœ… è¿›åº¦å·²æ›´æ–°ï¼š${n}/${r}`)},y=()=>{const n={topicId:l,topicTitle:s,currentStep:0,totalSteps:r,lastUpdated:new Date().toISOString(),timeSpent:0};u(n),b.info("å­¦ä¹ è¿›åº¦å·²é‡ç½®")},c=t.currentStep/t.totalSteps*100,g=t.currentStep>=t.totalSteps;return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-6 mb-6 bg-white shadow-lg dark:bg-gray-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"å­¦ä¹ è¿›åº¦"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full dark:bg-green-900 dark:text-green-200",children:[e.jsx("i",{className:"mr-1 fa-solid fa-check"}),"å·²å®Œæˆ"]}),e.jsx("button",{onClick:y,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:"é‡ç½®è¿›åº¦",children:e.jsx("i",{className:"fa-solid fa-refresh"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[t.currentStep," / ",t.totalSteps," æ­¥éª¤"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(c),"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx(k.div,{className:`h-3 rounded-full ${g?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-blue-500 to-purple-500"}`,initial:{width:0},animate:{width:`${c}%`},transition:{duration:.5,ease:"easeOut"}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 text-center rounded-lg bg-gray-50 dark:bg-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:t.timeSpent}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"å­¦ä¹ æ—¶é•¿(åˆ†é’Ÿ)"})]}),e.jsxs("div",{className:"p-3 text-center rounded-lg bg-gray-50 dark:bg-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.currentStep}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"å·²å®Œæˆæ­¥éª¤"})]})]}),e.jsxs("div",{className:"flex mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>m(t.currentStep+1),disabled:g,className:"flex-1 px-4 py-2 text-sm font-medium text-white transition-colors bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"å·²å®Œæˆ":"æ ‡è®°ä¸‹ä¸€æ­¥å®Œæˆ"}),t.currentStep>0&&e.jsx("button",{onClick:()=>m(t.currentStep-1),className:"px-4 py-2 text-sm font-medium text-gray-700 transition-colors bg-gray-200 rounded-lg hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:"å›é€€ä¸€æ­¥"})]}),t.lastUpdated&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["æœ€åæ›´æ–°ï¼š",new Date(t.lastUpdated).toLocaleString("zh-CN")]})]})}const j=new Map;let w=!1;const f=[],v=()=>{window.MathJax&&(window.MathJax={tex:{inlineMath:[["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,packages:{"[+]":["noerrors","physics"]}},svg:{fontCache:"global",scale:1,exFactor:.5},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},startup:{ready:()=>{w=!0,window.MathJax.startup.defaultReady(),f.length>0&&window.MathJax.typesetPromise&&(window.MathJax.typesetPromise(f).catch(a=>{console.error("MathJax batch rendering error:",a)}),f.length=0)}}})},S=()=>{if(window.MathJax){v();return}if(!document.getElementById("MathJax-script")){const a=document.createElement("script");a.id="MathJax-script",a.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",a.async=!0,a.onload=v,document.head.appendChild(a)}};S();function M({formula:a,className:l="",inline:s=!1}){const r=o.useRef(null),[i,x]=o.useState(!1),t=o.useMemo(()=>`${a}_${s?"inline":"block"}`,[a,s]),d=o.useMemo(()=>a.replace(/\\\\/g,"\\"),[a]),h=o.useMemo(()=>s?`\\(${d}\\)`:`$$${d}$$`,[d,s]);o.useEffect(()=>{const c=j.get(t);if(r.current)if(c&&!i){const g=c.cloneNode(!0);r.current.innerHTML="",r.current.appendChild(g),x(!0)}else r.current.innerHTML=h,w&&window.MathJax&&window.MathJax.typesetPromise?window.MathJax.typesetPromise([r.current]).then(()=>{r.current&&r.current.firstChild&&j.set(t,r.current.firstChild.cloneNode(!0)),x(!0)}).catch(g=>{console.error("MathJax rendering error:",g)}):f.push(r.current)},[a,s,t,h,i]);const u=s?`inline-block ${l}`:`math-formula text-center ${l}`,m=s?"inline-block px-2 py-1":"inline-block p-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 transition-all duration-300";return e.jsx("div",{className:u,children:e.jsxs("div",{className:m,children:[!i&&!j.has(t)&&e.jsx("div",{className:"animate-pulse bg-gray-200 dark:bg-gray-700 rounded",style:{minHeight:s?"1.2em":"2rem",minWidth:s?"2em":"4rem"}}),e.jsx("div",{ref:r,className:`text-gray-900 dark:text-gray-100 transition-opacity duration-300 ${i?"opacity-100":"opacity-0"}`,style:{minHeight:s?"1.2em":"2rem",lineHeight:s?"inherit":"1.8",position:"relative",zIndex:1}})]})})}function E({onFormulaChange:a,initialFormula:l="",className:s=""}){const[r,i]=o.useState(l),[x,t]=o.useState(!1),d=o.useRef(null);o.useEffect(()=>{a&&a(r)},[r,a]);const h=c=>{i(c.target.value)},u=()=>{t(!0),setTimeout(()=>{d.current&&d.current.focus()},0)},m=()=>{t(!1)},y=c=>{c.key==="Enter"&&c.ctrlKey&&m(),c.key==="Escape"&&t(!1)};return e.jsxs("div",{className:`math-formula-editor ${s}`,children:[x?e.jsxs("div",{className:"space-y-4",children:[e.jsx("textarea",{ref:d,value:r,onChange:h,onKeyDown:y,className:"w-full p-3 font-mono text-sm border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white",rows:4,placeholder:"è¾“å…¥LaTeXå…¬å¼ï¼Œä¾‹å¦‚ï¼š\\\\frac{a}{b} æˆ– \\\\vec{F} = m\\\\vec{a}"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-white transition-colors bg-blue-600 rounded-lg hover:bg-blue-700",children:"ä¿å­˜ (Ctrl+Enter)"}),e.jsx("button",{onClick:()=>t(!1),className:"px-4 py-2 text-white transition-colors bg-gray-600 rounded-lg hover:bg-gray-700",children:"å–æ¶ˆ (Esc)"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg dark:border-gray-700 min-h-[100px] flex items-center justify-center",children:r?e.jsx(M,{formula:r}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ·»åŠ æ•°å­¦å…¬å¼"})}),e.jsx("button",{onClick:u,className:"px-4 py-2 text-white transition-colors bg-green-600 rounded-lg hover:bg-green-700",children:"ç¼–è¾‘å…¬å¼"})]}),r&&e.jsxs("div",{className:"p-3 mt-4 rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:"LaTeXæºç ï¼š"}),e.jsx("code",{className:"font-mono text-sm text-gray-800 dark:text-gray-200",children:r})]})]})}export{C as L,E as M};
